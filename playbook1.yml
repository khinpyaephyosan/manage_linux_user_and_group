---
- name: Create users on the Linux!
  hosts: all
  tasks:
  - name: Creating user1!
    user:
       name: "{{ item }}"
       password: "{{ password | password_hash('sha512') }}"
       state: present
    loop:
         - "{{ user1 }}"
         
  - name: Creating user2!
    user:
       name: "{{ item }}"
       password: "{{ password | password_hash('sha512') }}"
       state: present
    loop:
         - "{{ user2 }}"

  - name: Expire password1!
    command: chage -d 0 {{ item }}
    with_subelements:
         - "{{ user1 }}"
   
  - name: Expire password1!
    command: chage -d 0 {{ item }}
    with_subelements:
         - "{{ user2 }}"

  - name: Create group1!
    command: groupadd "{{ item }}"
    loop:
         - "{{ group1 }}"
         
  - name: Create group2!
    command: groupadd "{{ item }}"
    loop:
         - "{{ group2 }}"
         

  - name: Append user to group
    user:
       name: "{{ item.name }}"
       shell: /bin/bash
       groups: "{{ item.groups }}"
       append: yes
    loop:
         - "[ name: {{ user1 }} , groups: {{ group1 }} ]"
         - "[ name: {{ user2 }} , groups: {{ group2 }} ]"
...
